{{- /* Initialize variables for use in this file */ -}}
{{- $delta := lookPath "delta" -}}
{{- $diffGuitool := "" -}}
{{- $diffTool := "" -}}
{{- $difftastic := lookPath "difft" -}}
{{- $gvim := lookPath "gvim" -}}
{{- $gvimCommand := "" -}}
{{- $icdiff := lookPath "icdiff" -}}
{{- $ksdiff := lookPath "ksdiff" -}}
{{- $mvim := lookPath "mvim" -}}
{{- $vim := lookPath "vim" -}}

{{- /* Set the values  */ -}}
{{- if $ksdiff -}}
{{-   $diffGuitool = "Kaleidoscope" -}}
{{- end -}}
{{- if $difftastic -}}{{- /* difftastic */ -}}
{{-   $diffTool = "difftastic" -}}
{{- else if $delta -}}
{{-   $diffTool = "delta" -}}
{{- else if $icdiff -}}
{{-   $diffTool = "icdiff" -}}
{{- end -}}
{{- if $gvim -}}
{{-   $gvimCommand = "gvim" -}}
{{- else if $mvim -}}
{{-   $gvimCommand = "mvim" -}}
{{- end -}}

# [color.diff]
#   meta = blue bold
#   frag = magenta bold
#   old = red bold
#   new = green bold
#
# [color.diff-highlight]
# 	oldNormal = "blue"
# 	oldHighlight = "blue reverse"
# 	newNormal = "yellow"
# 	newHighlight = "yellow reverse" diff = always

[diff]
  algorithm = histogram
  colorMoved = default
  compactionHeuristic = true
  indentHeuristic = true
  mnemonicprefix = true
  renames = copies
  submodule = log
{{- if $diffGuitool }}
  guitool = {{ $diffGuitool | quote }}
{{- end }}
{{- if $diffTool }}
  tool = {{ $diffTool | quote }}
{{- end }}

{{ if $delta -}}
[delta]
  navigate = true
  side-by-side = true
{{- end }}

[difftool]
  prompt = false

{{ if $difftastic -}}
[difftool "difftastic"]
  cmd = difft "$LOCAL" "$REMOTE"
{{- end }}

{{ if $icdiff -}}
[difftool "icdiff"]
  cmd = icdiff --line-numbers "${LOCAL}" "${REMOTE}"
{{- end }}

{{ if $delta -}}
[difftool "delta"]
  cmd = delta "${LOCAL}" "${REMOTE}" "${MERGED}"
{{- end }}

[merge]
  log = true
  conflictstyle = diff3
  ff = false

{{ if or $gvim $mvim -}}
[mergetool "gvim"]
  cmd = {{ $gvimCommand }} -d --remote-wait-silent "${LOCAL}" "${MERGED}" "${REMOTE}"
  trustExitCode = true
{{- end }}

{{ if $vim -}}
[mergetool "vimdiff"]
  cmd = vim -d "${LOCAL}" "${MERGED}" "${REMOTE}"
  trustExitCode = true
{{- end }}

{{ if $ksdiff -}}
[difftool "Kaleidoscope"]
  cmd = ksdiff --partial-changeset --relative-path "${MERGED}" -- "${LOCAL}" "${REMOTE}"

[mergetool "Kaleidoscope"]
  cmd = ksdiff --merge --output "${MERGED}" --base "${BASE}" -- "${LOCAL}" --snapshot "${REMOTE}" --snapshot
  trustExitCode = true
{{- end }}

# vim: ft=gitconfig
