# General SSH configuration
ForwardAgent yes
HashKnownHosts no
ServerAliveCountMax 6
ServerAliveInterval 30
VerifyHostKeyDNS yes

Host *
  UseKeychain yes
  AddKeysToAgent yes

{{- if gt (.ssh.keys | len) 0 -}}
  {{ range .ssh.keys -}}
    {{- if stat (joinPath $.chezmoi.homeDir ".ssh" .) }}
Host *
  IdentityFile {{ joinPath $.chezmoi.homeDir ".ssh" . }}
    {{- end }}
  {{- end }}
{{- end }}

{{- if (lookPath "ssh-chain") }}Host *^*
  ProxyCommand ssh-chain %h %p{{ end }}

{{- if gt ((dig "ssh" "hosts" (list) .) | len) 0 }}{{ range .ssh.hosts }}
Host {{ .host }}{{ range .config }}
  {{ . }}{{ end }}
{{ end }}{{ end -}}
