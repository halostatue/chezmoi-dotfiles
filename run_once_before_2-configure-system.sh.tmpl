#!/usr/bin/env bash

{{ if (eq .chezmoi.os "darwin") -}}
osascript -e 'tell application "System Preferences" to quit'

if command -v gsed > /dev/null 2>&1; then
  grep -q pam_tid.so /etc/pam.d/sudo ||
    sudo gsed -i '2iauth        sufficient     pam_tid.so' /etc/pam.d/sudo
fi

# Dock settings
#
defaults write com.apple.dock orientation -string "right"
defaults write com.apple.dock "tilesize" -int 43
defaults write com.apple.dock minimize-to-application -bool true
defaults write com.apple.dock launchanim -bool true
defaults write com.apple.dock show-process-indicators -bool true
killall Dock

# Finder settings
#
defaults write com.apple.Finder "AppleShowAllFiles" -bool "true"
defaults write com.apple.finder QLEnableTextSelection -bool true
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"
defaults write com.apple.finder FXPreferredViewStyle -string "Nlsv"
defaults write com.apple.finder SearchRecentsSavedViewStyle -string "Nlsv"
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true
killall Finder

# Software Update settings
#
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticCheckEnabled -bool true
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticDownload -bool true
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticallyInstallMacOSUpdates -bool false
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate ConfigDataInstall -bool true
defaults write com.apple.commerce AutoUpdate -bool true
{{- end }}
