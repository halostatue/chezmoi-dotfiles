#! /bin/bash

# See https://docs.brew.sh/Manpage#environment for possible values.

if command -v bat >/dev/null 2>/dev/null; then
  export HOMEBREW_BAT=1
fi

export HOMEBREW_DISPLAY_INSTALL_TIMES=1

{{ if kindIs "map" (dig "github" "tokens" "" .) -}}
{{-   if kindIs "map" (get .github.tokens "homebrew_api") -}}
{{-     $e := .github.tokens.homebrew_api -}}
{{-     $v := (onepasswordDetailsFields $e.name $e.vault $e.account) -}}
export HOMEBREW_GITHUB_API_TOKEN={{ $v.credential.value | quote }}
{{-   end }}

{{-   if kindIs "map" (get .github.tokens "homebrew_packages") -}}
{{-     $e := .github.tokens.homebrew_packages }}
{{-     $v := (onepasswordDetailsFields $e.name $e.vault $e.account) -}}
export HOMEBREW_GITHUB_PACKAGES_TOKEN={{ $v.credential.value | quote }}
export HOMEBREW_GITHUB_PACKAGES_USER={{ $v.username.value | quote }}
{{-   end -}}
{{- end }}

# export HOMEBREW_NO_ANALYTICS=1
# export HOMEBREW_NO_AUTO_UPDATE=1
# export HOMEBREW_NO_GITHUB_API=1

export HOMEBREW_NO_INSECURE_REDIRECT=1
