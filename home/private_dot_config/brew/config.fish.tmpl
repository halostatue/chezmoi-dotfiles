#! /usr/bin/env fish

# See https://docs.brew.sh/Manpage#environment

if command --query bat
    set --global --export HOMEBREW_BAT 1
end

set --global --export HOMEBREW_DISPLAY_INSTALL_TIMES 1

{{ if kindIs "map" (dig "github" "tokens" "" .) -}}
{{-   if kindIs "map" (get .github.tokens "homebrew_api") -}}
{{-     $e := .github.tokens.homebrew_api -}}
{{-     $v := (onepasswordDetailsFields $e.name $e.vault $e.account) -}}
set --global --export HOMEBREW_GITHUB_API_TOKEN {{ $v.credential.value | quote }}
{{-   end }}

{{-   if kindIs "map" (get .github.tokens "homebrew_packages") -}}
{{-     $e := .github.tokens.homebrew_packages -}}
{{-     $v := (onepasswordDetailsFields $e.name $e.vault $e.account) -}}
set --global --export HOMEBREW_GITHUB_PACKAGES_TOKEN {{ $v.credential.value | quote }}
set --global --export HOMEBREW_GITHUB_PACKAGES_USER {{ $v.username.value | quote }}
{{-   end -}}
{{- end }}

# set --global --export HOMEBREW_NO_ANALYTICS 1
# set --global --export HOMEBREW_NO_AUTO_UPDATE 1
# set --global --export HOMEBREW_NO_GITHUB_API 1

set --global --export HOMEBREW_NO_INSECURE_REDIRECT 1
